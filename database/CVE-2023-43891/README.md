# CVE-2023-43891: Blind Command Injection in Netis N3Mv2-V1.0.1.865 Router's Changing Username and Password Feature

## Information
**Description:** A critical vulnerability in the Netis N3Mv2-V1.0.1.865 router firmware within the "Changing Username and Password" feature, allowing an attacker to execute arbitrary commands on the router. This could lead to unauthorized access and control over the device.  
**Versions Affected:** Netis N3Mv2-V1.0.1.865  
**Version Fixed:** Information not available at the time of this disclosure  
**Researcher:** [Achmad Adhikara](https://github.com/adhikara13)  
**Disclosure Link:** [Link to your blog or disclosure](https://www.luwaklab.my.id/blog)  
**NIST CVE Link:** [NIST CVE Link](https://nvd.nist.gov/vuln/detail/CVE-2023-43891)  

## Proof-of-Concept Exploit
### Description
The vulnerability arises from inadequate input validation in the "Changing Username and Password" feature. Attackers can exploit this by injecting malicious usernames or passwords, executing arbitrary commands on the router.

## Vulnerability Details

The vulnerable portion of the code resides in the "Changing Username and Password" feature:

```
void FUN_00408dd0(void)

{
  undefined auStack1160 [64];
  undefined auStack1096 [64];
  undefined auStack1032 [1024];
  
  memset(auStack1032,0,0x400);
  memset(auStack1160,0,0x40);
  memset(auStack1096,0,0x40);
  apmib_get(0x15d,auStack1160);
  apmib_get(0x15e,auStack1096);
  RunSystemCmd("echo \"root::0:0:root:/:/bin/sh\" > /var/passwd");
  RunSystemCmd("echo \"nobody:x:0:0:nobody:/:/dev/null\" >> /var/passwd");
  RunSystemCmd("echo \"%s::0:0:guest:/:/bin/sh\" >> /var/passwd",auStack1160);
  RunSystemCmd("echo %s:%s | chpasswd -m",auStack1160,auStack1096);
  RunSystemCmd("echo root:%s | chpasswd -m",auStack1096);
  RunSystemCmd("echo \"root:x:0:root\" > /var/group");
  RunSystemCmd("echo \"nobody:x:0:nobody\" >> /var/group");
  RunSystemCmd("echo \"%s:x:0:guest\" >> /var/group",auStack1160);
  RunSystemCmd("chmod 755 /var/passwd");
  RunSystemCmd("chmod 755 /var/group");
  fwrite("Changed Username and Password ...........\n",1,0x2a,stderr);
  return;
}
```
The code accepts user input for new usernames and passwords. Unfortunately, this input is not adequately validated, leading to a command injection vulnerability. An attacker can craft malicious usernames or passwords, such as ls, to execute arbitrary commands on the router, including downloading files through wget for out-of-band exploitation.

### Usage/Exploitation
#### Step 1: Access Router Settings
- Log into the Netis N3Mv2-V1.0.1.865 router's web interface.
- Navigate to the settings for changing the username and password.

#### Step 2: Craft Malicious Input
- Prepare a malicious username or password with embedded commands. Example:
  ```
  `reboot` # An example command
  ```

#### Step 3: Input and Execute
- Enter the crafted malicious username or password into the relevant fields.
- Apply the changes to execute the embedded command.

#### Step 4: Monitor Router Behavior
- Observe the router for signs of command execution, such as unexpected behaviors or responses.

### Screenshot
[![POC Video](https://img.youtube.com/vi/pGxg0RLarSc/maxresdefault.jpg)](https://youtu.be/pGxg0RLarSc)
